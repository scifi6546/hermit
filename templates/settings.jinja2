<!DOCTYPE html>
<head>
	<link href="/static/index.css" rel="stylesheet"></link>
	 <script src="static/jquery.js" type="text/javascript"></script>
	 <script src="static/playlists.js" type="text/javascript"></script>
</head>
<div class="topnav">
	<a href="TEST" class="topnav_link">Log Out</a>
	<a href="/settings" class="topnav_active">Settings</a>
	<a href="/" class="topnav_link">Home</a>
	<a href="playlists" class="topnav_link">Playlists</a>
</div>
<div class = "body">
	<div class="form">
		<div class= "form_item">
			Thumbnail Resolution: <input type="text" class="thumb_res"/>
		</div>
		<button class="submit">Submit</button>
		<button class="add_user">Add User</button>

	</div>
</div>
<script>
	var edit_user_menue="<div class='edit_user' id={USER_NAME}"
	var edit_user_div = "<div class='user'>"+
	"{USER_NAME}<button class='edit_user' id='{USER_NAME}'>Edit User</button>"+
	"</div>";
	$.ajax({url:"/api/get_user",type:"GET",complete:function(foo){
		console.log(foo);
		users= JSON.parse(foo.responseText).users;
		console.log(users);
		console.log("got users");
		for(i in users){
			console.log(users[i]);
			console.log(users[i].username);
			var temp_div = edit_user_div.replace(/{USER_NAME}/gi,users[i].username);
			var user_edit = $(".form").append(temp_div);
			var child = user_edit.children()
			console.log(child.get(".edit_user"));
			console.log("child: ");
			console.log(child);
			
		}
		$(".edit_user").on('click',function(data){
			console.log("hello world");
			console.log(data);
			
		});
	}});
	var is_user_add_open=false;
	$(".add_user")[0].onclick=function(){
		if(is_user_add_open==false){
			var add_user_div="<div class='form_item'>"+
			"Username: <input type='text' class='add_user_username'/>"+
			"Password: <input type='password' class='add_user_password'/>"+
				"Confirm Password: <input type='password' class='add_user_password_confirm'/>"+
			"<button class='add_user_submit'>Sumbit</button>"+
			"</div>";
			let user_add_form = $(".form").append(add_user_div);
			console.log(user_add_form);
			$(".add_user_submit")[0].onclick=function(div){
				console.log($(".add_user_username"));
				console.log($(".add_user_username").val());
				var username = $(".add_user_username").val();
				var password = $(".add_user_password").val();
				var password_confirm=$(".add_user_password_confirm").val();
				if(password==password_confirm){
					var user = {username:username,password:password};
					output = JSON.stringify(user);
					$.ajax({url:"/api/add_user",type:"POST",data:output,contentType:"application/json",dataType:"json",mimeType:"application/json",complete:function(){
						console.log("done loading");
						$(".loader").remove();	
					}});
					console.log("adding user");
					console.log(user);
				}
			}

			is_user_add_open=true;
		}
	}

		$(".submit")[0].onclick=function(p){
			$(".form").append("<div class='loader'/>");
			var thumb_res = Math.floor($(".thumb_res").val());
			output = {action:"set_resolution",args:thumb_res.toString()};
			output = JSON.stringify(output);
			console.log(output);

			$.ajax({url:"/api/settings",type:"POST",data:output,contentType:"application/json",dataType:"json",mimeType:"application/json",complete:function(){
				console.log("done loading");
				$(".loader").remove();	
			}});
		}
</script>
<style>
 .loader {
  border: 16px solid #f3f3f3; /* Light grey */
  border-top: 16px solid #3498db; /* Blue */
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 2s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
