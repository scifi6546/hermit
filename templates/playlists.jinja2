<!DOCTYPE html>
<head>
	<link href="/static/index.css" rel="stylesheet"></link>
	<meta name="viewport" content="width=device-width, initial-scale=1" /> 
	 <script src="static/jquery.js" type="text/javascript"></script>
</head>
<div class="topnav">
	<a href="TEST" class="topnav_link">Log Out</a>
	<a href="/settings" class="topnav_link">Settings</a>
	<a href="/" class="topnav_active">Home</a>
	<a href="/playlists" class="topnav_link">Playlists</a>
</div>
<div class="body">
</div>
<script>
var playlist_play = 
	"<div class=playlist_play id={PLAYLIST_NAME}>"+
		"<div class=video_div>"+
			"<video class=playlist_video>"+
				"<source src='{VIDEO_URL}'/>"+
			"</video>"+
		"</div>"+
		"<div class=video_preview_div>"+

		"</div>"+
	"</div>"
var playlist_div=
	"<div class=playlist id={PLAYLIST_NAME}><img src='{THUMB_URL}'class=thumbnail/>{PLAYLIST_NAME}</div>";
var playlist_preview_div="<img class=video_thumb src='{THUMB_URL}'/>";
function setup_playlist_preview_div(ajax){
	let data = JSON.parse(ajax.responseText);
	let preview_str = playlist_preview_div.replace(/{THUMB_URL}/,data.thumbnail_url);
	let preview_div = $(".video_preview_div").append(preview_str);
	console.log(ajax);
}
//adds playlist when a video is gotten from /api/get_video
function add_playlist_html(ajax_response){
	console.log(ajax_response);
	let video = JSON.parse(ajax_response.responseText);
	
	console.log(video);
	let temp_str = playlist_div.replace(/{PLAYLIST_NAME}/gi,this.name);
	temp_str = temp_str.replace(/{THUMB_URL}/gi,video.thumbnail_url);
	let playlist_div_html = $(".body").append(temp_str);
	console.log(playlist_div_html);
	//Again I am sorry. I am setting videos on playlist_div_html inorder to
	//acces video data
	// Setting playlist to this which is playlist passed in through context
	playlist_div_html[0].video=video;
	playlist_div_html[0].playlist = this;
	playlist_div_html[0].onclick=function(input){
		console.log(this);
		$(".body").empty();
		let play_str = playlist_play.replace(/{PLAYLIST_NAME}/gi,input.id);
		console.log(this.video.url);
		play_str = play_str.replace(/{VIDEO_URL}/gi,this.video.url);
		$(".body").append(play_str);
		console.log($(".playlist_video")[0]);
		for(i in this.playlist.video_paths){
			let get_json = {video_path:this.playlist.video_paths[i]}
			let data_str = JSON.stringify(get_json);
			$.ajax({url:"/api/get_video",type:"POST",data:data_str,contentType:"application/json",dataType:"json",mimeType:"application/json",complete:setup_playlist_preview_div});
		}
	}
}
$.ajax({url:"/api/get_playlist_all",type:"GET",complete:function(input){
	console.log(input);
	let plays = JSON.parse(input.responseText);
	for(i in plays){
		get_json = {video_path:plays[i].video_paths[0]}
		let data_str = JSON.stringify(get_json);
		console.log(data_str);
		//I am sorry future me I had to write this mess, this gets an ajax request
		//and on complete addes the playlist div to the body object
		//the context sets this inside of the internal function as plays[i]
		$.ajax({context:plays[i],url:"/api/get_video",type:"POST",data:data_str,contentType:"application/json",dataType:"json",mimeType:"application/json",complete:add_playlist_html});
	}
}});
</script>
